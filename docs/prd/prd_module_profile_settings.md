## PRD: 排班助手 - 模块: 我的/设置 (Profile/Settings) 功能拓展

**文档目的**: 本文档定义我的/设置模块的下一阶段功能拓展。

---

### 功能拓展 4.1: 多设备云同步 (Multi-Device Cloud Sync)

*   **目标**: 实现用户排班数据的云端存储和多设备同步，允许用户在不同设备上无缝访问和编辑自己的排班数据。
*   **用户故事**:
    *   作为一名同时使用手机和平板的用户，我希望在一台设备上添加或修改排班后，另一台设备能自动更新，保持数据一致。
    *   作为一名担心手机丢失导致数据丢失的用户，我希望能将数据备份到云端，以便在新设备上恢复。
*   **功能需求 (FR)**:
    *   FR4.1.1: **账户系统**:
        *   实现简单的用户账户系统（如邮箱+密码注册/登录，或集成第三方登录如Google/Apple ID）。
        *   提供找回密码功能。
    *   FR4.1.2: **云存储后端**:
        *   选择并集成一个云数据库后端（如 Firebase Firestore, AWS DynamoDB, 或自建服务）。
        *   设计云端数据模型以存储用户账户信息、班次数据、班次类型、设置偏好等。
    *   FR4.1.3: **同步逻辑**:
        *   **首次同步**: 用户登录后，将本地数据与云端数据合并（或选择覆盖方向）。
        *   **增量同步**: 本地数据发生变更（增、删、改）时，自动将变更推送至云端。
        *   **下拉同步**: 应用启动时、或从后台恢复时、或手动触发时，从云端拉取最新数据更新本地。
    *   FR4.1.4: **冲突解决**:
        *   定义冲突解决策略（如“最后写入者获胜”）。当同一条数据在本地和云端都被修改时，根据策略决定保留哪个版本。
        *   （高级）对于关键冲突，可提示用户手动选择保留哪个版本。
    *   FR4.1.5: **离线支持**:
        *   在无网络连接时，所有操作应能在本地正常进行并保存。
        *   网络恢复后，自动将离线期间的本地变更同步至云端。
    *   FR4.1.6: **同步状态提示**: 在UI上提供清晰的同步状态指示（如“同步中”、“已同步”、“离线”）。
    *   FR4.1.7: **数据安全**:
        *   传输过程中使用HTTPS加密。
        *   敏感数据（如密码）在存储前进行哈希处理。
        *   云端数据库设置安全规则，确保用户只能访问自己的数据。
    *   FR4.1.8: **设置选项**: 提供手动触发同步、查看上次同步时间、退出登录等选项。
*   **非功能需求 (NFR)**:
    *   NFR4.1.1: **可靠性**: 同步过程应可靠，尽量减少数据丢失风险。
    *   NFR4.1.2: **性能**: 同步不应过度消耗设备电量和流量。
    *   NFR4.1.3: **安全性**: 严格保护用户数据隐私和安全。
*   **UI/UX**:
    *   需要设计账户登录/注册界面。
    *   同步状态的提示要自然不突兀。
    *   冲突解决（如果需要用户介入）的界面要清晰易懂。
*   **依赖**: 强依赖网络连接和云服务后端。需要账户系统支持。

---

### 功能拓展 4.2: 日历集成增强 (Enhanced Calendar Integration)

*   **目标**: 改善应用内排班数据与设备系统日历之间的数据同步体验，提供更灵活的配置选项。
*   **用户故事**:
    *   作为一名习惯使用系统日历查看所有日程的用户，我希望在排班助手App中添加或修改班次后，能自动更新到我的系统日历对应的事件中，无需手动操作。
    *   (可选) 作为一名用户，我希望能选择将系统日历中标记为“工作”的事件导入到排班助手中作为参考或直接创建班次。
*   **功能需求 (FR)**:
    *   FR4.2.1: **权限请求**: 在首次启用日历集成或执行相关操作时，向用户请求读/写系统日历的权限，并清晰说明原因。
    *   FR4.2.2: **配置选项**:
        *   在设置中提供"日历集成"选项。
        *   允许用户选择要同步到的系统日历账户（如果设备上有多个日历账户）。
        *   **同步方向**:
            *   **单向同步 (App -> 系统日历)**: (默认或核心) App中的班次创建/更新/删除时，自动在系统日历中创建/更新/删除对应事件。
            *   **双向同步 (App <-> 系统日历)**: (高级/可选) 实现系统日历事件变更反向同步回App（需仔细设计，避免循环同步和冲突）。
            *   **关闭同步**: 完全禁用日历集成。
        *   **事件模板**: 允许用户自定义同步到系统日历的事件标题、描述格式（如包含班次类型、时间、备注等）。
        *   **同步时机**: 可选配置为实时同步或定时/手动同步。
    *   FR4.2.3: **同步实现 (App -> 系统日历)**:
        *   **创建**: 在App中添加班次时，使用系统日历API创建对应事件，包含起止时间、标题、备注等信息。记录App内班次ID与系统日历事件ID的映射关系。
        *   **更新**: 在App中修改班次时，通过映射关系找到对应系统日历事件并更新。
        *   **删除**: 在App中删除班次时，通过映射关系找到对应系统日历事件并删除。
    *   FR4.2.4: **同步实现 (系统日历 -> App) (可选)**:
        *   监听系统日历变更事件（若平台支持）。
        *   或定期扫描系统日历指定时间范围内的事件。
        *   根据事件信息匹配或创建App内的班次（需要用户确认或设定规则）。
    *   FR4.2.5: **错误处理**: 处理权限不足、API调用失败、找不到日历账户等错误情况，并向用户提供反馈。
*   **非功能需求 (NFR)**:
    *   NFR4.2.1: **可靠性**: 同步操作应准确无误。
    *   NFR4.2.2: **性能**: 同步不应过度消耗资源。
*   **UI/UX**:
    *   权限请求说明要清晰。
    *   日历集成设置界面选项要明确。
    *   同步过程中的状态或错误提示要到位。
*   **依赖**: 需要集成处理系统日历的插件（如`device_calendar`或平台特定API）。

---

### 功能拓展 4.3: 用户反馈渠道 (User Feedback Channel)

*   **目标**: 在应用内提供便捷的用户反馈入口，方便用户报告问题、提出建议，并允许附带日志信息，帮助开发者定位和解决问题。
*   **用户故事**:
    *   作为一名遇到应用闪退的用户，我希望能快速将问题报告给开发者，并附上相关的日志，以便问题能被尽快修复。
    *   作为一名对应用有新功能想法的用户，我希望能方便地将我的建议发送给开发团队。
*   **功能需求 (FR)**:
    *   FR4.3.1: **反馈入口**: 在"设置"或"关于"页面添加"反馈与建议"入口。
    *   FR4.3.2: **反馈表单**:
        *   **反馈类型**: 支持选择“问题报告”、“功能建议”或其他分类。
        *   **描述**: 必填的多行文本框，供用户详细描述问题或建议。
        *   **联系方式 (可选)**: 允许用户填写邮箱地址，以便开发者回复。
        *   **附加日志 (可选)**: 提供一个开关选项，允许用户同意附加最近的应用日志信息。默认关闭。
    *   FR4.3.3: **日志附加**: 如果用户同意附加日志，系统应调用`LogService`获取近期的日志内容（如过去24小时或指定大小）。日志内容在发送前应进行脱敏处理（如果LogService已实现）。
    *   FR4.3.4: **反馈提交**:
        *   点击提交按钮后，将反馈类型、描述、联系方式（若有）和日志（若附加）打包。
        *   通过预设方式发送给开发者（如：发送邮件到指定邮箱、调用特定API接口将反馈存入后台系统）。
    *   FR4.3.5: **提交确认**: 提交成功后，向用户显示确认信息（如“感谢您的反馈！”）。提交失败时，显示错误提示。
*   **非功能需求 (NFR)**:
    *   NFR4.3.1: **隐私**: 明确告知用户将收集哪些信息（特别是日志），并获得用户同意。日志发送前应脱敏。
    *   NFR4.3.2: **易用性**: 反馈流程应简单快捷。
*   **UI/UX**:
    *   反馈表单设计简洁明了。
    *   附加日志的选项和说明要清晰。
*   **依赖**: 依赖`LogService`提供日志获取和导出功能。需要配置反馈接收方式（邮箱或API）。

---
