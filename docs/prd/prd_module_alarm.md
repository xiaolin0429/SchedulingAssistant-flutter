## PRD: 排班助手 - 模块: 闹钟提醒 (Alarm) - 恢复与增强

**文档目的**: 本文档定义闹钟提醒模块的恢复与功能增强。

---

### 功能拓展 5.1: 闹钟功能恢复与增强 (Alarm Restoration & Enhancement)

*   **目标**: 恢复并增强班次闹钟提醒功能，为用户提供可靠、可配置的班前提醒服务。
*   **用户故事**:
    *   作为一名经常忘记上班时间的用户，我希望能设置在班次开始前30分钟收到通知提醒，避免迟到。
    *   作为一名不希望在夜间被提醒打扰的用户，我希望能设置一个“免打扰时段”，在该时段内即使有班次提醒也不会发出声音或振动。
*   **功能需求 (FR)**:
    *   FR5.1.1: **代码恢复**: 解除`main.dart`、`injection_container.dart`以及相关UI页面中对闹钟服务(`AlarmService`)、BLoC和相关页面的注释。
    *   FR5.1.2: **全局开关**: 在设置中提供一个总开关，允许用户启用或禁用所有班次闹钟提醒。
    *   FR5.1.3: **提醒时间配置**: 允许用户设置提醒提前时间（如：准时、提前15分钟、30分钟、1小时、2小时）。
    *   FR5.1.4: **闹钟调度**:
        *   当用户添加或修改带有具体开始时间的班次时，如果全局开关开启，则根据用户设置的提前时间，使用系统通知服务（如`flutter_local_notifications`）调度一个本地通知。
        *   当用户删除班次或关闭全局开关时，取消对应的已调度通知。
        *   应用启动时，检查并重新调度所有未来班次的提醒（防止应用更新或系统重启导致通知丢失）。
    *   FR5.1.5: **通知内容**: 通知应包含班次类型、开始时间等关键信息。
    *   FR5.1.6: **免打扰时段 (Quiet Hours)**:
        *   在设置中允许用户设置一个每日的免打扰起止时间（如 22:00 - 07:00）。
        *   如果预定的通知触发时间落在免打扰时段内，通知应**静默发送**（即只显示在通知栏，没有声音或振动）。
        *   需要适配不同平台的静默通知实现方式。
    *   FR5.1.7: **可靠性增强**:
        *   在Android上，考虑使用精确闹钟API (`SCHEDULE_EXACT_ALARM`权限，需谨慎申请和说明) 提高提醒准时性。
        *   在iOS上，研究是否需要申请关键警报权限 (`Critical Alerts`) 以确保通知能覆盖系统静音设置（仅适用于真正需要强提醒的场景，需苹果审核）。
        *   处理设备重启后的闹钟重新调度。
    *   FR5.1.8: **权限处理**: 在启用闹钟功能时，检查并请求必要的通知权限。
*   **非功能需求 (NFR)**:
    *   NFR5.1.1: **可靠性**: 闹钟提醒必须准时、可靠。
    *   NFR5.1.2: **电池效率**: 闹钟调度不应过度消耗电池。
    *   NFR5.1.3: **用户控制**: 用户应能完全控制是否接收提醒以及提醒方式。
*   **UI/UX**:
    *   闹钟相关设置（开关、提前时间、免打扰时段）应集中在一个设置区域。
    *   通知内容要简洁有效。
*   **依赖**: 依赖本地通知插件 (`flutter_local_notifications`)、时间处理库 (`timezone`) 和权限处理插件 (`permission_handler`)。

---
